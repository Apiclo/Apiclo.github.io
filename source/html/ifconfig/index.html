<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>网络连接信息</title>
    <style>
        /* 保持原有样式不变 */
        body { font-family: Arial, sans-serif; background-color: #f0f0f0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 2em; }
        .container { width: 100%; max-width: 600px; }
        .card { background: white; border-radius: 15px; padding: 1em; margin: 1em; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card h3 { color: #333; margin-top: 0; }
        .card p { color: #666; margin: 0.5em 0; }
        .ip-label { font-weight: bold; color: #444; }
        .dns-type { font-size: 0.9em; color: #888; }
        .loading { color: #999; font-style: italic; }
        .ip-card { margin: 0.5em 0; padding: 0.5em; background: #f8f8f8; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- 拆分IP类型卡片 -->
        <div class="card">
            <h3>域名解析信息 - IPv4</h3>
            <div class="ip-card">
                <p><span class="ip-label">解析地址:</span> 
                    <span id="server-ipv4">
                        <div class="loading">正在查询A记录...</div>
                    </span>
                </p>
            </div>
        </div>

        <div class="card">
            <h3>域名解析信息 - IPv6</h3>
            <div class="ip-card">
                <p><span class="ip-label">解析地址:</span> 
                    <span id="server-ipv6">
                        <div class="loading">正在查询AAAA记录...</div>
                    </span>
                </p>
            </div>
        </div>

        <!-- 其他卡片保持原样 -->
        <div class="card">
            <h3>客户端信息</h3>
            <p><span class="ip-label">客户端IP:</span> <span id="client-ip">检测中...</span></p>
        </div>

        <div class="card">
            <h3>连接类型</h3>
            <p><span class="ip-label">IP 版本:</span> <span id="connection-type">检测中...</span></p>
        </div>
    </div>

    <script>
        // 独立查询函数
        async function queryDNS(domain, type, containerId) {
            const container = document.getElementById(containerId);
            try {
                const response = await fetch(
                    `https://doh.pub/dns-query?name=${domain}&type=${type}`,
                    { headers: { 'Accept': 'application/dns-json' } }
                );
                
                if (!response.ok) throw new Error('DNS查询失败');
                const data = await response.json();
                
                const records = data.Answer?.map(record => record.data) || [];
                updateIPDisplay(container, records, type);

            } catch (error) {
                console.error(`DNS ${type}记录查询失败:`, error);
                container.innerHTML = `<span style="color:red">查询失败: ${error.message}</span>`;
            }
        }

        // 更新显示的函数
        function updateIPDisplay(container, records, type) {
            container.innerHTML = ''; // 清除加载状态
            
            if (records.length > 0) {
                const div = document.createElement('div');
                div.innerHTML = `
                    ${records.join(', ')}
                    <span class="dns-type">(${type}记录)</span>
                `;
                container.appendChild(div);
            } else {
                container.innerHTML = '<span style="color:#888">未找到解析记录</span>';
            }
        }

        // 独立查询IPv4/IPv6
        async function showDNSInfo() {
            const domain = window.location.hostname;
            
            // 并行但独立处理查询
            await Promise.allSettled([
                queryDNS(domain, 'A', 'server-ipv4'),
                queryDNS(domain, 'AAAA', 'server-ipv6')
            ]);
        }

        /* 保持原有的getClientIP函数不变 */
        async function getClientIP() {
            try {
                const responses = await Promise.allSettled([
                    fetch('https://www.taobao.com/help/getip.php'),
                    fetch('https://ip.3322.net/')
                ]);

                let taobaoIP, ip3322;
                // 处理淘宝响应
                if (responses[0].status === 'fulfilled') {
                    const text = await responses[0].value.text();
                    taobaoIP = text.match(/"ip":"(\d+\.\d+\.\d+\.\d+)"/)?.[1];
                }
                // 处理3322响应
                if (responses[1].status === 'fulfilled') {
                    ip3322 = await responses[1].value.text();
                }

                const clientIP = taobaoIP || ip3322 || '未知';
                document.getElementById('client-ip').textContent = clientIP;
                document.getElementById('connection-type').textContent = 
                    clientIP.includes(':') ? 'IPv6' : 'IPv4';

            } catch (error) {
                console.error('客户端信息获取失败:', error);
                document.getElementById('client-ip').textContent = '获取失败';
                document.getElementById('connection-type').textContent = '检测失败';
            }
        }

        // 初始化加载
        window.addEventListener('load', () => {
            document.getElementById('current-domain').textContent = window.location.hostname;
            getClientIP();
            showDNSInfo();
        });
    </script>
</body>
</html>