<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç½‘ç»œçŠ¶æ€æ£€æµ‹</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; max-width: 500px; margin: 0 auto; padding: 20px; }
        .card { background: #fff; border-radius: 10px; padding: 20px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .status { margin: 10px 0; }
        .loading:after { content: '...'; animation: dots 1s infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } }
    </style>
</head>
<body>
    <div class="card">
        <h3>ğŸŒ æœåŠ¡å™¨è§£æ</h3>
        <div class="status">IPv4: <span id="ipv4">æ£€æµ‹ä¸­<span class="loading"></span></span></div>
        <div class="status">IPv6: <span id="ipv6">æ£€æµ‹ä¸­<span class="loading"></span></span></div>
    </div>

    <div class="card">
        <h3>ğŸ“± å®¢æˆ·ç«¯ä¿¡æ¯</h3>
        <div class="status">IPåœ°å€: <span id="clientIp">æ£€æµ‹ä¸­<span class="loading"></span></span></div>
        <div class="status">åè®®ç±»å‹: <span id="ipType">æ£€æµ‹ä¸­<span class="loading"></span></span></div>
    </div>

<script>
// æç®€IPæ£€æµ‹æ–¹æ¡ˆ
const detectIP = async () => {
    // ä¸»ç”¨APIï¼ˆæ¸…åå¤§å­¦é•œåƒç«™ï¼‰
    try {
        const res = await fetch('https://mirrors.tuna.tsinghua.edu.cn/ip', {signal: AbortSignal.timeout(2000)});
        const ip = await res.text();
        if(ip.match(/\d+\.\d+\.\d+\.\d+/) || ip.includes(':')) {
            updateClient(ip.trim());
            return;
        }
    } catch {}

    // å¤‡ç”¨æ–¹æ¡ˆ1ï¼ˆä¸­å›½ç§‘æŠ€ç½‘ï¼‰
    try {
        const res = await fetch('https://www.ipv6.scu.edu.cn/getip.php');
        const data = await res.json();
        updateClient(data.ip);
        return;
    } catch {}

    // å¤‡ç”¨æ–¹æ¡ˆ2ï¼ˆWebRTCå›é€€ï¼‰
    try {
        const ip = await new Promise((resolve) => {
            const pc = new RTCPeerConnection({iceServers: []});
            pc.createDataChannel('');
            pc.createOffer().then(sdp => pc.setLocalDescription(sdp));
            pc.onicecandidate = ice => ice.candidate && resolve(ice.candidate.address.match(/([\d.]+)/)?.[0]);
        });
        ip && updateClient(ip);
    } catch {}
};

// DNSè§£ææ–¹æ¡ˆ
const checkDNS = async () => {
    const domain = location.hostname;
    const dnsCheck = async (type) => {
        try {
            const res = await fetch(`https://doh.pub/dns-query?name=${domain}&type=${type}`, {
                headers: {Accept: 'application/dns-json'}
            });
            const data = await res.json();
            return data.Answer?.[0]?.data || 'æ— è®°å½•';
        } catch {
            return 'æŸ¥è¯¢å¤±è´¥';
        }
    };

    document.getElementById('ipv4').textContent = await dnsCheck('A');
    document.getElementById('ipv6').textContent = await dnsCheck('AAAA');
};

// æ›´æ–°æ˜¾ç¤º
const updateClient = (ip) => {
    document.getElementById('clientIp').textContent = ip;
    document.getElementById('ipType').textContent = ip.includes(':') ? 'IPv6' : 'IPv4';
};

// å¯åŠ¨æ£€æµ‹
(async () => {
    await Promise.allSettled([detectIP(), checkDNS()]);
    document.querySelectorAll('.loading').forEach(e => e.remove());
})();
</script>
</body>
</html>